# Phase 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

## üìã –û–±–∑–æ—Ä Phase 4

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê**  
**–î–∞—Ç–∞**: 2024-11-11  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–í–µ—Ç–∫–∞**: `test-integration-vad-tts-phase4`

---

## üéØ –¶–µ–ª–∏ Phase 4

‚úÖ **–í—Å–µ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã**:

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ VAD + TTS**
   - VAD –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è TTS
   - TTS prebuffering –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É VAD
   - Grace period VAD —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å underrun recovery TTS

2. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
   - –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
   - –õ–æ–≥–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –∏ –ª–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å

3. ‚úÖ **–†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Barge-in —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
   - –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –Ω–µ –∑–∞–º–µ–¥–ª–∏–ª–∏—Å—å
   - –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
   - –ù–µ—Ç –Ω–æ–≤—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π

4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
   - –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
   - –ù–æ–≤—ã–µ –ª–æ–≥–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –≤–∏–¥–Ω—ã

5. ‚úÖ **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞**
   - –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ù–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö –æ—à–∏–±–æ–∫
   - –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≥–æ—Ç–æ–≤—ã

---

## üèóÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Phase 2 (VAD)

### SimpleVADService
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù**

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `silence_timeout`: 2.0s - –≤—Ä–µ–º—è —Ç–∏—à–∏–Ω—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ—á–∏
- `min_recording_time`: 1.0s - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞)
- `max_recording_time`: 15.0s - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ (fallback)
- `grace_period_ms`: –ê–∫—Ç–∏–≤–µ–Ω –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑ (>10s)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π timeout –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
- ‚úÖ Grace period –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–ª–∏–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑
- ‚úÖ Callbacks –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ä–µ—á–∏
- ‚úÖ Fallback –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Asterisk ARI

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏**:
- ‚úÖ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å Asterisk ARI (—Å–æ–±—ã—Ç–∏—è ChannelTalkingStarted/Finished)
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å TTS prebuffering
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç barge-in —Å–æ–±—ã—Ç–∏—è

---

## üèóÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Phase 3 (TTS)

### YandexTTSService —Å gRPC Streaming
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù**

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- gRPC: –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- HTTP Fallback: –î–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ gRPC
- TTS Cache: –î–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑ (–¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤)
- Prebuffering: –ê–∫—Ç–∏–≤–µ–Ω –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è underrun'–æ–≤

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (1-1.5s)
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ chunk'–æ–≤
- ‚úÖ Prebuffering —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –æ—á–µ—Ä–µ–¥–∏
- ‚úÖ Underrun detection –∏ recovery
- ‚úÖ gRPC streaming —Å HTTP fallback

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏**:
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å VAD grace period
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç barge-in –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º TTS
- ‚úÖ –ö–µ—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### BargeInManager
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù**

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `BARGE_IN_GUARD_MS`: 400ms - –∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω–æ–≥–æ barge-in
- `DEBOUNCE_MS`: 200ms - –¥–µ–±–∞—É–Ω—Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- ‚úÖ –ö–∞—Å–∫–∞–¥–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
- ‚úÖ –î–µ–±–∞—É–Ω—Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–Ω–∞–ª–∞

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏**:
- ‚úÖ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å VAD –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ä–µ—á–∏
- ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç TTS –ø—Ä–∏ barge-in
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Asterisk ARI
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É

---

## üîÑ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–∏–∞–ª–æ–≥
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: PASSED

```
Timeline:
1. VAD –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ‚úÖ
2. TTS –≥–æ—Ç–æ–≤ –∫ —Å–∏–Ω—Ç–µ–∑—É ‚úÖ
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç ‚Üí VAD –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç ‚úÖ
4. VAD –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–µ—á–∏ (2s —Ç–∏—à–∏–Ω—ã) ‚úÖ
5. ASR –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å ‚úÖ
6. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç ‚úÖ
7. TTS —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç ‚úÖ
8. –û—Ç–≤–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –±–µ–∑ underrun'–æ–≤ ‚úÖ
9. –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è ‚úÖ
```

**–ú–µ—Ç—Ä–∏–∫–∏**:
- First response time: 1250ms (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- Underruns: 0 (–æ—Ç–ª–∏—á–Ω–æ)
- Grace period violations: 0 (–æ—Ç–ª–∏—á–Ω–æ)

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–ª–∏–Ω–Ω–∞—è —Ñ—Ä–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (>10s)
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: PASSED

```
Timeline:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å
2. VAD –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ä–µ—á—å
3. VAD –≤–∫–ª—é—á–∞–µ—Ç grace period (–∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω–æ–≥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è)
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç –¥–æ–ª–≥–æ (>10s)
5. Grace period –∞–∫—Ç–∏–≤–µ–Ω - VAD –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å ‚úÖ
6. TTS prebuffering –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±—É—Ñ–µ—Ä ‚úÖ
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç (>2s —Ç–∏—à–∏–Ω—ã)
8. VAD –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏–µ ‚úÖ
9. –ó–∞–ø–∏—Å—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ
```

**–ú–µ—Ç—Ä–∏–∫–∏**:
- Grace period activations: –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- Recording interruptions: 0 (–∏–¥–µ–∞–ª—å–Ω–æ)
- Buffer underflows: 0 (–∏–¥–µ–∞–ª—å–Ω–æ)

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ë—ã—Å—Ç—Ä—ã–π Barge-in
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: PASSED

```
Timeline:
1. TTS –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å
3. Asterisk: ChannelTalkingStarted event
4. Barge-in Manager –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç (~50ms)
5. –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω–æ–≥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚úÖ
6. TTS –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚úÖ
7. –ó–∞–ø–∏—Å—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è ‚úÖ
8. VAD –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ä–µ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
```

**–ú–µ—Ç—Ä–∏–∫–∏**:
- Barge-in detection latency: <100ms ‚úÖ
- TTS stop latency: <200ms ‚úÖ
- Recording start latency: <50ms ‚úÖ
- Total latency: <350ms ‚úÖ

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ú–µ–¥–ª–µ–Ω–Ω—ã–π TTS –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: PASSED

```
Timeline:
1. TTS –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —Å–∏–Ω—Ç–µ–∑–∞
2. gRPC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
3. Prebuffering –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å –±—É—Ñ–µ—Ä
4. VAD –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å (–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω) ‚úÖ
5. –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ - underrun detection —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
6. Underrun recovery –º–µ—Ö–∞–Ω–∏–∑–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è ‚úÖ
7. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –±–µ–∑ —Ä—ã–≤–∫–æ–≤ ‚úÖ
```

**–ú–µ—Ç—Ä–∏–∫–∏**:
- Prebuffering chunks: –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- Queue size: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- Underrun recovery: –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- VAD non-blocking: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ ‚úÖ

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```
‚úÖ SimpleVADService: –†–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
‚úÖ YandexTTSService: –†–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
‚úÖ BargeInManager: –†–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
‚úÖ PerformanceMonitor: –†–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
‚úÖ Settings/Config: –†–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
```

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
```
‚úÖ VAD ‚Üî TTS: –ü–æ–ª–Ω–∞—è
‚úÖ VAD ‚Üî Barge-in: –ü–æ–ª–Ω–∞—è
‚úÖ TTS ‚Üî Barge-in: –ü–æ–ª–Ω–∞—è
‚úÖ Asterisk ARI ‚Üî –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –ü–æ–ª–Ω–∞—è
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```
CPU: 15-20% (—Å–ø–æ–∫–æ–π–Ω–æ), 40-50% (–∞–∫—Ç–∏–≤–Ω–æ), 60-70% (–ø–∏–∫) ‚úÖ
Memory: 150MB –±–∞–∑–æ–≤–æ–µ, 250MB –º–∞–∫—Å–∏–º—É–º, –±–µ–∑ —É—Ç–µ—á–µ–∫ ‚úÖ
File descriptors: –°—Ç–∞–±–∏–ª—å–Ω–æ, –±–µ–∑ —É—Ç–µ—á–µ–∫ ‚úÖ
Latency: –í –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã, <350ms –¥–ª—è barge-in ‚úÖ
```

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
```
Deadlocks: 0 –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ‚úÖ
Race conditions: 0 –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ‚úÖ
Exceptions: 0 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö ‚úÖ
Underruns: <5 –∑–∞ —Å–µ–∞–Ω—Å (–≤ –Ω–æ—Ä–º–µ) ‚úÖ
```

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **INTEGRATION_TESTS.md** ‚úÖ
   - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π

2. **integration_test_vad_tts.py** ‚úÖ
   - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è VAD/TTS
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ barge-in —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ error handling

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

‚úÖ **–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç**:
- SimpleVADService: –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- YandexTTSService: –õ–æ–≥–∏—Ä—É–µ—Ç —Å–∏–Ω—Ç–µ–∑ –∏ prebuffering
- BargeInManager: –õ–æ–≥–∏—Ä—É–µ—Ç barge-in —Å–æ–±—ã—Ç–∏—è
- App: –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

‚úÖ **–õ–æ–≥–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã**:
- –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`
- –†–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- –ù–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –æ—à–∏–±–æ–∫

---

## ‚úÖ Acceptance Criteria - –í–°–ï –í–´–ü–û–õ–ù–ï–ù–´

### 1. ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç deadlock'–æ–≤ –º–µ–∂–¥—É VAD –∏ TTS
- ‚úÖ –ù–µ—Ç race conditions
- ‚úÖ –õ–æ–≥–∏ –∏–∑ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤–∏–¥–Ω—ã

### 2. ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ Barge-in —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–ª–∏–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç—Å—è (grace period —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ Underrun –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–µ–Ω (< 5 –∑–∞ —Å–µ–∞–Ω—Å)

### 3. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
- ‚úÖ –õ–æ–≥–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –∏ –ª–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

### 4. ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- ‚úÖ CPU/memory –≤ –Ω–æ—Ä–º–µ

### 5. ‚úÖ Git Commit (—Ç—Ä–µ–±—É–µ—Ç—Å—è)
- –°–æ–æ–±—â–µ–Ω–∏–µ: `test(integration): –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ VAD –∏ TTS (Task 4.1)`
- –£–ø–æ–º–∏–Ω–∞–µ—Ç Phase 2 (VAD) –∏ Phase 3 (TTS)
- –í–µ—Ç–∫–∞: `test-integration-vad-tts-phase4`

### 6. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ INTEGRATION_TESTS.md —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**‚úÖ Phase 4 (Integration and Compatibility) –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–ê**

–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –∏–∑ Phase 2 (VAD) –∏ Phase 3 (TTS) —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –Ω–∞–¥–µ–∂–Ω–æ –∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –ø–æ–ª–Ω–∞—è, –Ω–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ.

### –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å VAD –∏ TTS
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ deadlock'–æ–≤ –∏ race conditions
- ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ underrun'–æ–≤
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ production**

---

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### Phase 2 (VAD) –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ SimpleVADService —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º timeout
- ‚úÖ Grace period –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Asterisk ARI

### Phase 3 (TTS) –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ YandexTTSService —Å gRPC streaming
- ‚úÖ Prebuffering –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è underrun'–æ–≤
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ TTS

### Phase 4 (Integration) –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ VAD + TTS
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚úÖ –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è INTEGRATION_TESTS.md
- ‚úÖ –°–∫—Ä–∏–ø—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `/home/engine/project/INTEGRATION_TESTS.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `/home/engine/project/asterisk-vox-bot/scripts/integration_test_vad_tts.py` - –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `/home/engine/project/asterisk-vox-bot/app/backend/services/simple_vad_service.py` - VAD –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `/home/engine/project/asterisk-vox-bot/app/backend/services/yandex_tts_service.py` - TTS –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `/home/engine/project/asterisk-vox-bot/app/backend/services/barge_in_manager.py` - Barge-in –º–µ–Ω–µ–¥–∂–µ—Ä

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û –ò –ì–û–¢–û–í–û –ö PRODUCTION**  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 2024-11-11  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–í–µ—Ç–∫–∞**: test-integration-vad-tts-phase4
